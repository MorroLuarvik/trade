# 2020.11.11 Понедельник
## Сбер
2020.11.11 в 11:06 по Хабаровску пришло письмо о месячном минимуме usd.  
Да, это был месячный минимум и валюта правильная, но цена была показана для серебра.

Выполнил скрипт:
```SQL
select 
    e.*, from_unixtime(e.event_ts) 
    , r.sell_price
from a_events as e 
inner join f_rates as r on r.rate_id = e.rate_id
order by e.event_ts 
desc limit 10;
```

Получил результат:
```
+----------+--------+---------+---------+------------+---------+---------------------------+------------+
| event_id | fin_id | rate_id | mode_id | event_ts   | is_used | from_unixtime(e.event_ts) | sell_price |
+----------+--------+---------+---------+------------+---------+---------------------------+------------+
|     1312 |      2 |   29750 |       0 | 1605057842 |       1 | 2020-11-11 04:24:02       |      59.96 |
|     1313 |      2 |   29750 |       1 | 1605057842 |       1 | 2020-11-11 04:24:02       |      59.96 |
|     1311 |      2 |   29749 |       1 | 1605057122 |       1 | 2020-11-11 04:12:02       |      60.13 |
|     1307 |      1 |   29746 |       0 | 1605056641 |       1 | 2020-11-11 04:04:01       |      76.66 |
|     1308 |      1 |   29746 |       1 | 1605056641 |       1 | 2020-11-11 04:04:01       |      76.66 |
|     1309 |      2 |   29747 |       0 | 1605056641 |       1 | 2020-11-11 04:04:01       |      59.99 |
|     1310 |      2 |   29747 |       1 | 1605056641 |       1 | 2020-11-11 04:04:01       |      59.99 |
|     1306 |      1 |   29744 |       1 | 1605049441 |       1 | 2020-11-11 02:04:01       |      78.06 |
|     1305 |      1 |   29743 |       1 | 1605047042 |       1 | 2020-11-11 01:24:02       |      78.43 |
|     1304 |      1 |   29742 |       1 | 1605046322 |       1 | 2020-11-11 01:12:02       |      78.16 |
+----------+--------+---------+---------+------------+---------+---------------------------+------------+
10 rows in set (0.00 sec)
```
Время генераци письма 2020.11.11 04:04
Как видно, на TS 1605056641 было 4 события.
Необходимо внести в домашнюю БД заявленные данные и воспроизвести этот баг.


```SQL
SELECT
    RL.rate_id,
    RL.fin_id,
    RL.buy_price,
    RL.sell_price,
    RL.event_ts,
    FROM_UNIXTIME(RL.event_ts) as event_dt,
    F.region_id,
    R.region_code,
    R.region_name,
    F.rate_category_id,
    RC.rate_category_code,
    RC.rate_category_name,
    F.curr_id,
    C.curr_code,
    C.curr_iso,
    C.curr_name,
    F.disabled
FROM f_rates as RL
INNER JOIN f_finances as F ON F.fin_id = RL.fin_id
INNER JOIN s_regions AS R ON R.region_id = F.region_id
INNER JOIN s_rate_categorys AS RC ON RC.rate_category_id = F.rate_category_id
INNER JOIN s_currencys AS C ON C.curr_id = F.curr_id
WHERE RL.fin_id = 1
ORDER BY fin_id, event_ts DESC
LIMIT 1
```

```SQL
select 
    e.*, from_unixtime(e.event_ts) 
    , r.sell_price
from a_events as e 
inner join f_rates as r on r.rate_id = e.rate_id
order by e.event_ts 
desc limit 10;
```

### По торговым сберовским делам
Было много оповещения о месячных минимумах usd, 10 оповещений, закупился 5 раз.

Также было оповещено о нисхдящем тренде по серебру, но т.к. годовая выручка составила бы 0.5%, закрывать счёт не стал.  
Также было 7 сообщений по месячному минимуму, срегаировал всего на один.

Под впечатлением о нисходящем тренде серебра, посмотрел выручку на курсе палладия: 31% годовых. Не удержался и закрыл сделку.  
Потом, за полночь было три сообщения о месячном минимуме. Но я уже спал.